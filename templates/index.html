<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Game</title>

<style>
* {
  box-sizing: border-box;
  font-family: "Poppins";
}

body {
  margin: 0;
  min-height: 100vh;
  background: linear-gradient(135deg, #43cea2, #185a9d);
  background-size: 400% 400%;
  animation: gradientBG 10s ease infinite;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  overflow: hidden;
}

@keyframes gradientBG {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.card {
  background: rgba(255, 255, 255, 0.95);
  max-width: 450px;
  width: 100%;
  padding: 35px;
  border-radius: 18px;
  text-align: center;
  box-shadow: 0 20px 50px rgba(0,0,0,0.25);
  animation: slideUp 0.8s ease;
}

@keyframes slideUp {
  from { transform: translateY(40px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.header-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.logo {
  font-size: 40px;
  font-weight: 700;
}

.weather {
  font-size: 14px;
  background: #eef5ff;
  padding: 6px 12px;
  border-radius: 8px;
  font-weight: 800;
  color: #333;
}

input {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border-radius: 10px;
  border: 1px solid #ccc;
  outline: none;
  transition: 0.3s;
}

input:focus {
  border-color: #2575fc;
  box-shadow: 0 0 0 3px rgba(37, 117, 252, 0.25);
}

button {
  width: 100%;
  margin-top: 18px;
  padding: 14px;
  font-size: 17px;
  font-weight: 600;
  border: none;
  border-radius: 10px;
  background: linear-gradient(135deg, #2575fc, #6a11cb);
  color: white;
  cursor: pointer;
  transition: 0.3s;
}

button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

button:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.25);
}

.error {
  color: #e74c3c;
  font-size: 14px;
  margin-top: 8px;
}

.footer {
  margin-top: 20px;
  font-size: 13px;
  color: #777;
}
</style>
</head>

<body>

<div class="card">

  <div class="header-row">
    <div class="logo">üéØ</div>

    <div class="weather" id="weatherBox">
      ‚õÖ Loading...
    </div>
  </div>

  <h1>Ultimate Quiz Challenge</h1>
  <p class="subtitle">Test your knowledge & climb the leaderboard</p>
  
  {% if error %}
    <div class="error" id="serverError">{{ error }}</div>
  {% endif %}

  <form method="POST" action="/">
    <input
      type="text"
      id="nameInput"
      name="name"
      placeholder="Enter your name"
      autocomplete="off"
      required
    />

    <div class="error" id="clientError" style="display:none;"></div>

    <button type="submit" id="startBtn" disabled>üöÄ Start Quiz</button>
  </form>

  <div class="footer">Compete ‚Ä¢ Learn ‚Ä¢ Win</div>
</div>

<script>
const input = document.getElementById("nameInput");
const button = document.getElementById("startBtn");
const clientError = document.getElementById("clientError");
const serverError = document.getElementById("serverError");
const weatherBox = document.getElementById("weatherBox");

button.disabled = true;

// -------- NAME VALIDATION --------
input.addEventListener("input", () => {

  input.value = input.value
      .replace(/[^A-Za-z ]/g, "")   // only letters + space
      .replace(/\s+/g, " ");        // remove double spaces

  input.value = input.value.slice(0, 25); // max 25 char

  const count = input.value.trim().length;

  if (count < 3) {
    clientError.style.display = "block";
    clientError.textContent = `‚ö†Ô∏è Minimum 3 characters required (${count}/3)`;
    button.disabled = true;
  } else {
    clientError.style.display = "none";
    button.disabled = false;

    if (serverError) serverError.style.display = "none";
  }
});

document.querySelector("form").addEventListener("submit", (e) => {
  if (button.disabled) e.preventDefault();
});


// -------- WEATHER WITH CITY NAME (STABLE) --------
if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(async success => {

    const lat = success.coords.latitude;
    const lon = success.coords.longitude;

    try {
      // 1Ô∏è‚É£ Weather API
      const weatherRes = await fetch(
        `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`
      );
      const weatherData = await weatherRes.json();
      const temp = weatherData.current_weather.temperature;

      // 2Ô∏è‚É£ City API (Nominatim - very stable)
      const cityRes = await fetch(
        `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`
      );
      const cityData = await cityRes.json();

     const addr = cityData.address;

      const city =
        addr?.city ||
        addr?.district ||
        addr?.suburb ||
        addr?.town ||
        addr?.village ||
        addr?.county ||
        addr?.state ||
        "Your Area";


      weatherBox.innerHTML = `üå§Ô∏è ${city} ‚Äî ${temp}¬∞C`;

    } catch (e) {
      console.log(e);
      weatherBox.innerHTML = "üå§Ô∏è Weather Unavailable";
    }

  }, () => {
    weatherBox.innerHTML = "üå§Ô∏è Location Blocked";
  });
} else {
  weatherBox.innerHTML = "üå§Ô∏è Not Supported";
}

</script>

</body>
</html>
